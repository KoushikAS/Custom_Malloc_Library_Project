#include "my_malloc.h"
#include <stdio.h>
#include <stdlib.h>

void *ff_malloc(size_t size){
  if(head == NULL){ //Base Condition
     void *allocated_mem = sbrk(sizeof(size_t) + size);
     size_t *metadata = (size_t *)allocated_mem;
     *metadata = size;
     return allocated_mem +sizeof(size_t);
  }
  return NULL;
}

void ff_free(void * ptr){
  size_t *metadata = (size_t *)(ptr - sizeof(size_t));
  size_t size = *metadata;
  printf("Size_t %zu\n", size);

  memory_block_list block;
  block.start_address = ptr - sizeof(size_t);
  block.len = sizeof(size_t) + size;
  block.end_address = ptr + block.len;


  if(head == NULL) { //Adding first element in the list
    block.previous = NULL;
    block.next = NULL;
    head = &block;
    return;
  }

  if(head->start_address > block.start_address){ //Adding to the front (i.e. Head)
    block.previous = NULL;
    block.next = head;
    head->previous = &block;
    head = &block;
    return; 
  }
  
  memory_block_list *curr = head;
  while(curr->next != NULL && curr->next->start_address < block.start_address){
    curr = curr->next;
  }

  block.next = curr->next;
  block.previous = curr;
  if(curr->next != NULL){ //When we are adding to the end of the list.
    curr->next->previous = &block;
  }
  curr->next = &block;
  
  printf("something*");
}
  /** 
  memory_block_list **curr = &head;
  while(*curr != NULL && ((*curr)->start_address + (*curr)->len) < block.start_address){
   curr = &((*curr)->next);
  }
  if(*curr == NULL){
   block.next = NULL;
  }else{
   block.next = (*curr)->next;
  }
    
  *curr = &block;
  **/
